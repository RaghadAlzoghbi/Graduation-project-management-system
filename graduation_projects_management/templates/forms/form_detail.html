{% extends "base.html" %}
{% load static %}

{% block title %}Evaluation Form Details{% endblock title %}

{% block content %}
{% include "navbar.html" %}

<div class="container">
  <h2>Evaluation Form: {{ evaluation_form.form_name }}</h2>

  <!-- Display basic info -->
  <p><strong>Main Category Number:</strong> {{ evaluation_form.main_category_number }}</p>
  <p><strong>Main Category:</strong> {{ evaluation_form.main_category }}</p>
  <p><strong>Weight:</strong> {{ evaluation_form.weight }}</p>
  <p><strong>Type of Grade:</strong> {{ evaluation_form.type_of_grade }}</p>

  <h3>Subcategories:</h3>
  <ul>
    {% for sub in evaluation_form_instance.subcategories.all %}
      <li>{{ sub.sub_category }}</li>
    {% empty %}
      <li>No subcategories available.</li>
    {% endfor %}
  </ul>

  <!-- If user clicked "Edit" -->
  {% if request.GET.edit %}
    <h3>Edit Evaluation Form</h3>
    <form method="post">
      {% csrf_token %}
      <p>
        <label for="id_form_name">Form Name:</label>
        <input type="text" name="form_name" id="id_form_name" value="{{ evaluation_form.form_name }}" required>
      </p>
      <p>
        <label for="id_main_category_number">Main Category Number:</label>
        <input type="number" name="main_category_number" id="id_main_category_number" value="{{ evaluation_form.main_category_number }}" required>
      </p>
      <p>
        <label for="id_main_category">Main Category:</label>
        <input type="text" name="main_category" id="id_main_category" value="{{ evaluation_form.main_category }}" required>
      </p>
      <p>
        <label for="id_weight">Weight:</label>
        <input type="number" step="0.01" name="weight" id="id_weight" value="{{ evaluation_form.weight }}" required>
      </p>
      <p>
        <label for="id_type_of_grade">Type of Grade:</label>
        <select name="type_of_grade" id="id_type_of_grade" required>
          <option value="individual" {% if evaluation_form.type_of_grade == "individual" %}selected{% endif %}>Individual Grade</option>
          <option value="group" {% if evaluation_form.type_of_grade == "group" %}selected{% endif %}>Group Grade</option>
        </select>
      </p>
      <h3>Edit Subcategories</h3>
      <div id="subcategories">
        {% for sub in evaluation_form_instance.subcategories.all %}
          <div class="subcategory">
            <label>Subcategory:</label>
            <input type="text" name="subcategories[{{ forloop.counter0 }}][sub_category]" value="{{ sub.sub_category }}" required>
          </div>
        {% empty %}
          <div class="subcategory">
            <label>Subcategory:</label>
            <input type="text" name="subcategories[0][sub_category]" required>
          </div>
        {% endfor %}
      </div>
      <button type="button" id="add-subcategory" class="btn">Add Another Subcategory</button>
      <br><br>
      <button type="submit" name="update" value="update" class="btn">Update</button>
      <button type="submit" name="delete" value="true" class="btn" onclick="return confirm('Are you sure you want to delete this form?');">Delete</button>
    </form>
  {% else %}
    <a href="?edit=true" class="btn">Edit Evaluation Form</a>
  {% endif %}
</div>

<script>
  document.getElementById('add-subcategory').addEventListener('click', function(){
    var container = document.getElementById('subcategories');
    var index = container.children.length;
    var div = document.createElement('div');
    div.className = 'subcategory';
    div.innerHTML = '<label>Subcategory:</label>' +
                    '<input type="text" name="subcategories['+ index +'][sub_category]" required>';
    container.appendChild(div);
  });
</script>
{% endblock content %}
