{% extends "base.html" %}

{% block content %}
<h2>{{ form.name }}</h2>
<ul>
    {% for main_category in form.main_categories.all %}
    <li>
        <strong>{{ main_category.number }}. {{ main_category.text }}</strong> ({{ main_category.grade_type }}, Weight: {{ main_category.weight }})
        <ul>
            {% for sub_category in main_category.sub_categories.all %}
            <li>{{ sub_category.text }}</li>
            {% endfor %}
        </ul>
    </li>
    {% endfor %}
</ul>
<button id="delete-btn" data-id="{{ form.id }}" style="background-color: red; color: white;">
    Delete Form
</button>
<a href="{% url 'form:edit_evaluation_form' form.id %}">Edit Form</a>
<script>
    document.getElementById("delete-btn").addEventListener("click", function() {
        let formId = this.getAttribute("data-id");
    
        if (confirm("Are you sure you want to delete this form?")) {
            fetch(`/api/form/delete/${formId}/`, {
                method: "DELETE",
                headers: { "Content-Type": "application/json" }
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                window.location.href = "{% url 'form:evaluation_form_list' %}"; // Redirect to list
            })
            .catch(error => console.error("Error:", error));
        }
    });
</script>
    
{% endblock %}
